{% extends "base.html" %}

{% block title %}Promote Member - Taskforce Management{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-arrow-up me-2"></i>Promote/Demote Member
                </h4>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="member_id" class="form-label">Select Member <span class="text-danger">*</span></label>
                        <select class="form-select" id="member_id" name="member_id" required onchange="updateCurrentRank()">
                            <option value="">Choose a member...</option>
                            {% for member in members %}
                                <option value="{{ member.id }}" data-rank="{{ member.current_rank }}"
                                        {% if request.args.get('member_id') == member.id|string %}selected{% endif %}>
                                    {{ member.discord_username }} ({{ member.current_rank }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Current Rank</label>
                        <input type="text" class="form-control" id="current_rank_display" readonly 
                               placeholder="Select a member first...">
                    </div>

                    <div class="mb-3">
                        <label for="new_rank" class="form-label">New Rank <span class="text-danger">*</span></label>
                        <select class="form-select" id="new_rank" name="new_rank" required>
                            <option value="">Choose new rank...</option>
                            <option value="Aspirant">Aspirant</option>
                            <option value="Novice">Novice</option>
                            <option value="Adept">Adept</option>
                            <option value="Crusader">Crusader</option>
                            <option value="Paladin">Paladin</option>
                            <option value="Exemplar">Exemplar</option>
                            <option value="Prospect">Prospect</option>
                            <option value="Commander">Commander</option>
                            <option value="Marshall">Marshall</option>
                            <option value="General">General</option>
                            <option value="Chief General">Chief General</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="reason" class="form-label">Reason for Promotion/Demotion</label>
                        <textarea class="form-control" id="reason" name="reason" rows="3" 
                                  placeholder="Explain the reason for this rank change..."></textarea>
                        <div class="form-text">Optional but recommended for record keeping</div>
                    </div>

                    <div class="mb-4">
                        <label for="promoted_by" class="form-label">Promoted By <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="promoted_by" name="promoted_by" required 
                               placeholder="Your username">
                        <div class="form-text">Enter your Discord username</div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('home') }}" class="btn btn-outline-secondary me-md-2">
                            <i class="fas fa-times me-2"></i>Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Update Rank
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-sitemap me-2"></i>Rank Structure
                </h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center flex-wrap">
                    <div class="rank-item text-center mb-2">
                        <div class="badge bg-secondary mb-1">Aspirant</div>
                        <div><small>Entry Level</small></div>
                    </div>
                    <div class="rank-arrow">→</div>
                    <div class="rank-item text-center mb-2">
                        <div class="badge bg-primary mb-1">Novice</div>
                        <div><small>Basic</small></div>
                    </div>
                    <div class="rank-arrow">→</div>
                    <div class="rank-item text-center mb-2">
                        <div class="badge bg-info mb-1">Adept</div>
                        <div><small>Skilled</small></div>
                    </div>
                    <div class="rank-arrow">→</div>
                    <div class="rank-item text-center mb-2">
                        <div class="badge bg-success mb-1">Crusader</div>
                        <div><small>Veteran</small></div>
                    </div>
                </div>
                <div class="d-flex justify-content-between align-items-center flex-wrap mt-2">
                    <div class="rank-item text-center mb-2">
                        <div class="badge bg-warning mb-1">Paladin</div>
                        <div><small>Officer</small></div>
                    </div>
                    <div class="rank-arrow">→</div>
                    <div class="rank-item text-center mb-2">
                        <div class="badge bg-danger mb-1">Exemplar</div>
                        <div><small>Senior Officer</small></div>
                    </div>
                    <div class="rank-arrow">→</div>
                    <div class="rank-item text-center mb-2">
                        <div class="badge bg-dark mb-1">Prospect</div>
                        <div><small>Command</small></div>
                    </div>
                    <div class="rank-arrow">→</div>
                    <div class="rank-item text-center mb-2">
                        <div class="badge bg-purple mb-1" style="background-color: #6f42c1 !important;">Commander</div>
                        <div><small>High Command</small></div>
                    </div>
                </div>
                <div class="d-flex justify-content-between align-items-center flex-wrap mt-2">
                    <div class="rank-item text-center mb-2">
                        <div class="badge bg-secondary mb-1">Marshall</div>
                        <div><small>Senior Command</small></div>
                    </div>
                    <div class="rank-arrow">→</div>
                    <div class="rank-item text-center mb-2">
                        <div class="badge bg-danger mb-1">General</div>
                        <div><small>Top Command</small></div>
                    </div>
                    <div class="rank-arrow">→</div>
                    <div class="rank-item text-center mb-2">
                        <div class="badge bg-dark mb-1">Chief General</div>
                        <div><small>Supreme Leader</small></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function updateCurrentRank() {
    const select = document.getElementById('member_id');
    const currentRankDisplay = document.getElementById('current_rank_display');
    const selectedOption = select.options[select.selectedIndex];
    
    if (selectedOption && selectedOption.value) {
        const currentRank = selectedOption.getAttribute('data-rank');
        currentRankDisplay.value = currentRank;
    } else {
        currentRankDisplay.value = '';
    }
}

// Initialize on page load if member is pre-selected
document.addEventListener('DOMContentLoaded', function() {
    updateCurrentRank();
});
</script>

<style>
.rank-arrow {
    color: #6c757d;
    font-size: 1.2rem;
}
.rank-item {
    flex: 1;
    min-width: 80px;
}
@media (max-width: 768px) {
    .rank-arrow {
        display: none;
    }
}
</style>
{% endblock %}